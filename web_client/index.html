<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Du L·ªãch GIS</title>
    
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.9.1/mapbox-gl.css' rel='stylesheet' />
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="stylesheet" href="css/style.css">

    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        
        /* Ch·ªânh l·∫°i popup cho ƒë·∫πp m·ªôt ch√∫t */
        .mapboxgl-popup-content {
            padding: 15px;
            border-radius: 10px;
            font-family: Arial, sans-serif;
        }
        .mapboxgl-popup-content h3 {
            margin: 0 0 5px;
            color: #0078ff;
        }
    </style>
</head>
<body>

    <div id='map'></div>

    <script type="module">
        // Import c√°c h√†m t·ª´ 2 file JS b·∫°n v·ª´a s·ª≠a l√∫c n√£y
        import { initMap, addMarkersToMap } from './js/map_manager.js';
        import { fetchTouristSpots } from './js/api_service.js';

        // H√†m ch·∫°y ch√≠nh
        async function startApp() {
            try {
                // B∆∞·ªõc 1: V·∫Ω c√°i b·∫£n ƒë·ªì n·ªÅn
                console.log("üó∫Ô∏è ƒêang kh·ªüi t·∫°o b·∫£n ƒë·ªì...");
                initMap();

                // B∆∞·ªõc 2: ƒêi l·∫•y d·ªØ li·ªáu t·ª´ Supabase
                console.log("‚è≥ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Supabase...");
                const places = await fetchTouristSpots();
                
                if (places && places.length > 0) {
                    console.log(`‚úÖ ƒê√£ t√¨m th·∫•y ${places.length} ƒë·ªãa ƒëi·ªÉm!`);
                    
                    // B∆∞·ªõc 3: V·∫Ω c√°c ƒë·ªãa ƒëi·ªÉm l√™n b·∫£n ƒë·ªì
                    addMarkersToMap(places);
                } else {
                    console.warn("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y ƒë·ªãa ƒëi·ªÉm n√†o trong Database.");
                }

            } catch (error) {
                console.error("‚ùå C√≥ l·ªói x·∫£y ra:", error);
                alert("L·ªói h·ªá th·ªëng: Xem Console (F12) ƒë·ªÉ bi·∫øt chi ti·∫øt.");
            }
        }

        // B·∫Øt ƒë·∫ßu ch·∫°y!
        startApp();
    </script>

</body>
</html>